{
  "metadata" : {
    "realm" : null,
    "entityType" : "ScriptingService",
    "entityId" : "default/globalScripts/c4f22465-2368-4e27-8013-e6399974fd48",
    "uid" : "ou=c4f22465-2368-4e27-8013-e6399974fd48,ou=globalScripts,ou=default,ou=GlobalConfig,ou=1.0,ou=ScriptingService,ou=services,ou=am-config",
    "sunServiceID" : "globalScript",
    "objectClass" : [
      "top",
      "sunServiceComponent"
    ],
    "pathParams" : { },
    "ou" : null
  },
  "data" : {
    "_id" : "default/globalScripts/c4f22465-2368-4e27-8013-e6399974fd48",
    "_type" : {
      "_id" : "ScriptingService",
      "name" : "ScriptingService",
      "collection" : false
    },
    "createdBy" : "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
    "creationDate" : "1433147666269",
    "language" : "JAVASCRIPT",
    "script" : "LyoKICogQ29weXJpZ2h0IDIwMjEgRm9yZ2VSb2NrIEFTLiBBbGwgUmlnaHRzIFJlc2VydmVkCiAqIFVzZSBvZiB0aGlzIGNvZGUgcmVxdWlyZXMgYSBjb21tZXJjaWFsIHNvZnR3YXJlIGxpY2Vuc2Ugd2l0aCBGb3JnZVJvY2sgQVMuCiAqIG9yIHdpdGggb25lIG9mIGl0cyBhZmZpbGlhdGVzLiBBbGwgdXNlIHNoYWxsIGJlIGV4Y2x1c2l2ZWx5IHN1YmplY3QKICogdG8gc3VjaCBsaWNlbnNlIGJldHdlZW4gdGhlIGxpY2Vuc2VlIGFuZCBGb3JnZVJvY2sgQVMuCiAqLwoKLyoKICogVGhpcyBzY3JpcHQgcmV0dXJucyBhIGxpc3Qgb2YgU0FNTCBBdHRyaWJ1dGUgb2JqZWN0cyBmb3IgdGhlIElEUCBmcmFtZXdvcmsgdG8gaW5zZXJ0IGludG8gdGhlIGdlbmVyYXRlZCBBc3NlcnRpb24uCiAqCiAqIERlZmluZWQgdmFyaWFibGVzOgogKiBzZXNzaW9uIC0gU1NPVG9rZW4gKDEpCiAqICAgICAgICAgICBUaGUgc2luZ2xlIHNpZ24tb24gc2Vzc2lvbi4KICogaG9zdGVkRW50aXR5SWQgLSBTdHJpbmcgKHByaW1pdGl2ZSkuCiAqICAgICAgICAgICAgICAgICAgVGhlIGhvc3RlZCBlbnRpdHkgSUQuCiAqIHJlbW90ZUVudGl0eUlkIC0gU3RyaW5nIChwcmltaXRpdmUpLgogKiAgICAgICAgICAgICAgICAgIFRoZSByZW1vdGUgZW50aXR5IElELgogKiByZWFsbSAtIFN0cmluZyAocHJpbWl0aXZlKS4KICogICAgICAgICBUaGUgbmFtZSBvZiB0aGUgcmVhbG0gdGhlIHVzZXIgaXMgYXV0aGVudGljYXRpbmcgdG8uCiAqIGxvZ2dlciAtIEFsd2F5cyBwcmVzZW50LCB0aGUgZGVidWcgbG9nZ2VyIGluc3RhbmNlOgogKiAgICAgICAgICBodHRwczovL2JhY2tzdGFnZS5mb3JnZXJvY2suY29tL2RvY3MvYW0vNy9zY3JpcHRpbmctZ3VpZGUvc2NyaXB0aW5nLWFwaS1nbG9iYWwtbG9nZ2VyLmh0bWwjc2NyaXB0aW5nLWFwaS1nbG9iYWwtbG9nZ2VyLgogKiAgICAgICAgICBDb3JyZXNwb25kaW5nIGxvZyBmaWxlcyB3aWxsIGJlIHByZWZpeGVkIHdpdGg6IHNjcmlwdHMuU0FNTDJfSURQX0FUVFJJQlVURV9NQVBQRVIKICogaWRwQXR0cmlidXRlTWFwcGVyU2NyaXB0SGVscGVyIC0gSWRwQXR0cmlidXRlTWFwcGVyU2NyaXB0SGVscGVyICgyKQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLSBBbiBJZHBBdHRyaWJ1dGVNYXBwZXJTY3JpcHRIZWxwZXIgaW5zdGFuY2UgY29udGFpbmluZyBtZXRob2RzIHVzZWQgZm9yIElEUCBhdHRyaWJ1dGUgbWFwcGluZy4KICoKICogVGhyb3dzIFNBTUwyRXhjZXB0aW9uOgogKiAgICAgIC0gb24gZmFpbGluZyB0byBtYXAgdGhlIElEUCBhdHRyaWJ1dGVzLgogKgogKiBSZXR1cm4gLSBhIGxpc3Qgb2YgU0FNTCBBdHRyaWJ1dGUgKDMpIG9iamVjdHMuCiAqCiAqIENsYXNzIHJlZmVyZW5jZToKICogKDEpIFNTT1Rva2VuIC0gaHR0cHM6Ly9iYWNrc3RhZ2UuZm9yZ2Vyb2NrLmNvbS9kb2NzL2FtLzcvYXBpZG9jcy9jb20vaXBsYW5ldC9zc28vU1NPVG9rZW4uaHRtbC4KICogKDIpIElkcEF0dHJpYnV0ZU1hcHBlclNjcmlwdEhlbHBlciAtIGh0dHBzOi8vYmFja3N0YWdlLmZvcmdlcm9jay5jb20vZG9jcy9hbS83L2FwaWRvY3MvY29tL3N1bi9pZGVudGl0eS9zYW1sMi9wbHVnaW5zL3NjcmlwdGVkL0lkcEF0dHJpYnV0ZU1hcHBlclNjcmlwdEhlbHBlci5odG1sLgogKiAoMykgQXR0cmlidXRlIC0gaHR0cHM6Ly9iYWNrc3RhZ2UuZm9yZ2Vyb2NrLmNvbS9kb2NzL2FtLzcvYXBpZG9jcy9jb20vc3VuL2lkZW50aXR5L3NhbWwyL2Fzc2VydGlvbi9BdHRyaWJ1dGUuaHRtbC4KICovCgovKioKICogRGVmYXVsdCBTQU1MMiBJRFAgQXR0cmlidXRlIE1hcHBlci4KICovCmZ1bmN0aW9uIGdldEF0dHJpYnV0ZXMoKSB7CiAgICB2YXIgZnJKYXZhID0gSmF2YUltcG9ydGVyKAogICAgICAgIGNvbS5zdW4uaWRlbnRpdHkuc2FtbDIuY29tbW9uLlNBTUwyRXhjZXB0aW9uCiAgICApOwoKICAgIGNvbnN0IGRlYnVnTWV0aG9kID0gIlNjcmlwdGVkSURQQXR0cmlidXRlTWFwcGVyLmdldEF0dHJpYnV0ZXM6OiAiOwoKICAgIHRyeSB7CgogICAgICAgIGlmICghaWRwQXR0cmlidXRlTWFwcGVyU2NyaXB0SGVscGVyLmlzU2Vzc2lvblZhbGlkKHNlc3Npb24pKSB7CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihkZWJ1Z01ldGhvZCArICJJbnZhbGlkIHNlc3Npb24uIik7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNvbmZpZ01hcCA9IGlkcEF0dHJpYnV0ZU1hcHBlclNjcmlwdEhlbHBlci5nZXRSZW1vdGVTUENvbmZpZ0F0dHJpYnV0ZU1hcChyZWFsbSwgcmVtb3RlRW50aXR5SWQpOwogICAgICAgIGxvZ2dlci5tZXNzYWdlKGRlYnVnTWV0aG9kICsgIlJlbW90ZSBTUCBhdHRyaWJ1dGUgbWFwID0ge30iLCBjb25maWdNYXApOwogICAgICAgIGlmIChjb25maWdNYXAgPT0gbnVsbCB8fCBjb25maWdNYXAuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIGNvbmZpZ01hcCA9IGlkcEF0dHJpYnV0ZU1hcHBlclNjcmlwdEhlbHBlci5nZXRIb3N0ZWRJRFBDb25maWdBdHRyaWJ1dGVNYXAocmVhbG0sIGhvc3RlZEVudGl0eUlkKTsKICAgICAgICAgICAgaWYgKGNvbmZpZ01hcCA9PSBudWxsIHx8IGNvbmZpZ01hcC5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgIGxvZ2dlci5tZXNzYWdlKGRlYnVnTWV0aG9kICsgIkNvbmZpZ3VyYXRpb24gbWFwIGlzIG5vdCBkZWZpbmVkLiIpOwogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbG9nZ2VyLm1lc3NhZ2UoZGVidWdNZXRob2QgKyAiSG9zdGVkIElEUCBhdHRyaWJ1dGUgbWFwID0ge30iLCBjb25maWdNYXApOwogICAgICAgIH0KCiAgICAgICAgdmFyIGF0dHJpYnV0ZXMgPSBuZXcgamF2YS51dGlsLkFycmF5TGlzdCgpOwogICAgICAgIHZhciBzdHJpbmdWYWx1ZU1hcCA9IG5ldyBqYXZhLnV0aWwuSGFzaFNldCgpOwogICAgICAgIHZhciBiaW5hcnlWYWx1ZU1hcDsKICAgICAgICB2YXIgbG9jYWxBdHRyaWJ1dGU7CgogICAgICAgIC8vIERvbid0IHRyeSB0byByZWFkIHRoZSBhdHRyaWJ1dGVzIGZyb20gdGhlIGRhdGFzdG9yZSBpZiB0aGUgaWdub3JlZCBwcm9maWxlIGlzIGVuYWJsZWQgaW4gdGhpcyByZWFsbS4KICAgICAgICBpZiAoIWlkcEF0dHJpYnV0ZU1hcHBlclNjcmlwdEhlbHBlci5pc0lnbm9yZWRQcm9maWxlKHNlc3Npb24sIHJlYWxtKSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgLy8gUmVzb2x2ZSBhdHRyaWJ1dGVzIHRvIGJlIHJlYWQgZnJvbSB0aGUgZGF0YXN0b3JlLgogICAgICAgICAgICAgICAgdmFyIHN0cmluZ0F0dHJpYnV0ZXMgPSBuZXcgamF2YS51dGlsLkhhc2hTZXQoKTsKICAgICAgICAgICAgICAgIHZhciBiaW5hcnlBdHRyaWJ1dGVzID0gbmV3IGphdmEudXRpbC5IYXNoU2V0KCk7CiAgICAgICAgICAgICAgICB2YXIga2V5SXRlciA9IGNvbmZpZ01hcC5rZXlTZXQoKS5pdGVyYXRvcigpOwogICAgICAgICAgICAgICAgd2hpbGUgKGtleUl0ZXIuaGFzTmV4dCgpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IGtleUl0ZXIubmV4dCgpOwogICAgICAgICAgICAgICAgICAgIGxvY2FsQXR0cmlidXRlID0gY29uZmlnTWFwLmdldChrZXkpOwogICAgICAgICAgICAgICAgICAgIGlmICghaWRwQXR0cmlidXRlTWFwcGVyU2NyaXB0SGVscGVyLmlzU3RhdGljQXR0cmlidXRlKGxvY2FsQXR0cmlidXRlKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWRwQXR0cmlidXRlTWFwcGVyU2NyaXB0SGVscGVyLmlzQmluYXJ5QXR0cmlidXRlKGxvY2FsQXR0cmlidXRlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWRkIGl0IHRvIHRoZSBsaXN0IG9mIGF0dHJpYnV0ZXMgdG8gdHJlYXQgYXMgYmVpbmcgYmluYXJ5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaW5hcnlBdHRyaWJ1dGVzLmFkZChpZHBBdHRyaWJ1dGVNYXBwZXJTY3JpcHRIZWxwZXIucmVtb3ZlQmluYXJ5QXR0cmlidXRlRmxhZyhsb2NhbEF0dHJpYnV0ZSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nQXR0cmlidXRlcy5hZGQobG9jYWxBdHRyaWJ1dGUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICghc3RyaW5nQXR0cmlidXRlcy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgICAgICBzdHJpbmdWYWx1ZU1hcCA9IGlkcEF0dHJpYnV0ZU1hcHBlclNjcmlwdEhlbHBlci5nZXRBdHRyaWJ1dGVzKHNlc3Npb24sIHN0cmluZ0F0dHJpYnV0ZXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFiaW5hcnlBdHRyaWJ1dGVzLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgICAgIGJpbmFyeVZhbHVlTWFwID0gaWRwQXR0cmlidXRlTWFwcGVyU2NyaXB0SGVscGVyLmdldEJpbmFyeUF0dHJpYnV0ZXMoc2Vzc2lvbiwgYmluYXJ5QXR0cmlidXRlcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZGVidWdNZXRob2QgKyAiRXJyb3IgYWNjZXNzaW5nIHRoZSBkYXRhc3RvcmUuICIgKyBlcnJvcik7CiAgICAgICAgICAgICAgICAvL2NvbnRpbnVlIHRvIGNoZWNrIGluIHNzb3Rva2VuLgogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIga2V5SXRlciA9IGNvbmZpZ01hcC5rZXlTZXQoKS5pdGVyYXRvcigpOwogICAgICAgIHdoaWxlIChrZXlJdGVyLmhhc05leHQoKSkgewogICAgICAgICAgICB2YXIga2V5ID0ga2V5SXRlci5uZXh0KCkKICAgICAgICAgICAgdmFyIG5hbWVGb3JtYXQgPSBudWxsOwogICAgICAgICAgICB2YXIgc2FtbEF0dHJpYnV0ZSA9IGtleTsKICAgICAgICAgICAgbG9jYWxBdHRyaWJ1dGUgPSBjb25maWdNYXAuZ2V0KGtleSk7CiAgICAgICAgICAgIC8vIGNoZWNrIGlmIHNhbWxBdHRyaWJ1dGUgaGFzIGZvcm1hdCBuYW1lRm9ybWF0fHNhbWxBdHRyaWJ1dGUKICAgICAgICAgICAgdmFyIHNhbWxBdHRyaWJ1dGVzID0gU3RyaW5nKG5ldyBqYXZhLmxhbmcuU3RyaW5nKHNhbWxBdHRyaWJ1dGUpKTsKICAgICAgICAgICAgdmFyIHRva2VucyA9IHNhbWxBdHRyaWJ1dGVzLnNwbGl0KCd8Jyk7CgogICAgICAgICAgICBpZiAodG9rZW5zLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgIG5hbWVGb3JtYXQgPSB0b2tlbnNbMF07CiAgICAgICAgICAgICAgICBzYW1sQXR0cmlidXRlID0gdG9rZW5zWzFdOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYXR0cmlidXRlVmFsdWVzID0gbmV3IGphdmEudXRpbC5IYXNoU2V0KCk7CiAgICAgICAgICAgIGlmIChpZHBBdHRyaWJ1dGVNYXBwZXJTY3JpcHRIZWxwZXIuaXNTdGF0aWNBdHRyaWJ1dGUobG9jYWxBdHRyaWJ1dGUpKSB7CiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhlIHN0YXRpYyBmbGFnIGJlZm9yZSB1c2luZyBpdCBhcyB0aGUgc3RhdGljIHZhbHVlCiAgICAgICAgICAgICAgICBsb2NhbEF0dHJpYnV0ZSA9IGlkcEF0dHJpYnV0ZU1hcHBlclNjcmlwdEhlbHBlci5yZW1vdmVTdGF0aWNBdHRyaWJ1dGVGbGFnKGxvY2FsQXR0cmlidXRlKTsKICAgICAgICAgICAgICAgIGF0dHJpYnV0ZVZhbHVlcyA9IG5ldyBqYXZhLnV0aWwuSGFzaFNldChbbG9jYWxBdHRyaWJ1dGVdKTsKICAgICAgICAgICAgICAgIGxvZ2dlci5tZXNzYWdlKGRlYnVnTWV0aG9kICsgIkFkZGluZyBzdGF0aWMgdmFsdWUge30gZm9yIGF0dHJpYnV0ZSBuYW1lZCB7fSIsIGxvY2FsQXR0cmlidXRlLCBzYW1sQXR0cmlidXRlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChpZHBBdHRyaWJ1dGVNYXBwZXJTY3JpcHRIZWxwZXIuaXNCaW5hcnlBdHRyaWJ1dGUobG9jYWxBdHRyaWJ1dGUpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBmbGFnIGFzIG5vdCB1c2VkIGZvciBsb29rdXAKICAgICAgICAgICAgICAgICAgICBsb2NhbEF0dHJpYnV0ZSA9IGlkcEF0dHJpYnV0ZU1hcHBlclNjcmlwdEhlbHBlci5yZW1vdmVCaW5hcnlBdHRyaWJ1dGVGbGFnKGxvY2FsQXR0cmlidXRlKTsKICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVWYWx1ZXMgPSBpZHBBdHRyaWJ1dGVNYXBwZXJTY3JpcHRIZWxwZXIuZ2V0QmluYXJ5QXR0cmlidXRlVmFsdWVzKHNhbWxBdHRyaWJ1dGUsIGxvY2FsQXR0cmlidXRlLAogICAgICAgICAgICAgICAgICAgICAgICBiaW5hcnlWYWx1ZU1hcCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChzdHJpbmdWYWx1ZU1hcCAhPSBudWxsICYmICFzdHJpbmdWYWx1ZU1hcC5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlVmFsdWVzID0gc3RyaW5nVmFsdWVNYXAuZ2V0KGxvY2FsQXR0cmlidXRlKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIubWVzc2FnZShkZWJ1Z01ldGhvZCArICJ7fSBzdHJpbmcgdmFsdWUgbWFwIHdhcyBlbXB0eSBvciBudWxsLiIsIGxvY2FsQXR0cmlidXRlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gSWYgYWxsIGVsc2UgZmFpbHMsIHRyeSB0byBnZXQgdGhlIHZhbHVlIGZyb20gdGhlIHVzZXJzIHNzb1Rva2VuCiAgICAgICAgICAgICAgICBpZiAoYXR0cmlidXRlVmFsdWVzID09IG51bGwgfHwgYXR0cmlidXRlVmFsdWVzLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5tZXNzYWdlKGRlYnVnTWV0aG9kICsgIlVzZXIgcHJvZmlsZSBkb2VzIG5vdCBoYXZlIHZhbHVlIGZvciB7fSwgY2hlY2tpbmcgU1NPVG9rZW4uIiwgbG9jYWxBdHRyaWJ1dGUpOwogICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZVZhbHVlcyA9IG5ldyBqYXZhLnV0aWwuSGFzaFNldChpZHBBdHRyaWJ1dGVNYXBwZXJTY3JpcHRIZWxwZXIuZ2V0UHJvcGVydHlTZXQoc2Vzc2lvbiwgbG9jYWxBdHRyaWJ1dGUpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZVZhbHVlcyA9PSBudWxsIHx8IGF0dHJpYnV0ZVZhbHVlcy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgIGxvZ2dlci5tZXNzYWdlKGRlYnVnTWV0aG9kICsgInt9IG5vdCBmb3VuZCBpbiB1c2VyIHByb2ZpbGUgb3IgU1NPVG9rZW4uIiwgbG9jYWxBdHRyaWJ1dGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYXR0cmlidXRlcy5hZGQoaWRwQXR0cmlidXRlTWFwcGVyU2NyaXB0SGVscGVyLmNyZWF0ZVNBTUxBdHRyaWJ1dGUoc2FtbEF0dHJpYnV0ZSwgbmFtZUZvcm1hdCwgYXR0cmlidXRlVmFsdWVzKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBhdHRyaWJ1dGVzOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgbG9nZ2VyLmVycm9yKGRlYnVnTWV0aG9kICsgIkVycm9yIG1hcHBpbmcgSURQIGF0dHJpYnV0ZXMuICIgKyBlcnJvcik7CiAgICAgICAgdGhyb3cgbmV3IGZySmF2YS5TQU1MMkV4Y2VwdGlvbihlcnJvcik7CiAgICB9Cn0KCmdldEF0dHJpYnV0ZXMoKTs=",
    "description" : "Default global script for SAML2 IDP Attribute Mapper Script",
    "lastModifiedBy" : "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
    "context" : "SAML2_IDP_ATTRIBUTE_MAPPER",
    "lastModifiedDate" : "1433147666269",
    "name" : "SAML2 IDP Attribute Mapper Script"
  }
}
