<?xml version="1.0" encoding="UTF-8" ?>
<enterprise-security-extension
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="enterprise-security-extension.xsd"
        version="1">
    <access-log>
        <enabled>true</enabled>
        <file-name>access</file-name>
        <sub-folder>access</sub-folder>
        <write-through>true</write-through>
    </access-log>
    <realms>
        <jwt-realm>
            <name>ForgeRock</name>
            <enabled>true</enabled>
            <configuration>
                <jwks-endpoint>https://&{FQDN}/am/oauth2/connect/jwk_uri</jwks-endpoint>
            </configuration>
        </jwt-realm>
    </realms>
    <pipelines>
        <listener-pipeline name="forgerock-pipeline" listener="ALL">
            <jwt-authentication-manager>
                <realm>ForgeRock</realm>
                <jwt-validation>
                    <reserved-claims>
                        <scope>publish subscribe</scope>
                    </reserved-claims>
                    <custom-claims>
                        <claim>
                            <name>externalId</name>
                            <value>${mqtt-clientid}</value>
                        </claim>
                    </custom-claims>
                </jwt-validation>
            </jwt-authentication-manager>
            <allow-all-authorization-manager/>
        </listener-pipeline>
    </pipelines>
</enterprise-security-extension>